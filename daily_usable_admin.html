<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Dashboard - Greenplum DBA</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: NiceAdmin
  * Updated: Mar 09 2023 with Bootstrap v5.2.3
  * Template URL: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center">

    <div class="d-flex align-items-right justify-content-between">
      <i class="bi bi-list toggle-sidebar-btn align-items-center"></i>&nbsp;&nbsp;
      <a href="index.html" class="logo d-flex align-items-center">
        <img src="assets/img/logo.png" alt="">
        <span class="d-none d-lg-block" style="color: #012970;">&nbsp;Greenplum DBA</span>
      </a>
    </div><!-- End Logo -->

    <nav class="header-nav ms-auto">

    </nav><!-- End Icons Navigation -->

  </header><!-- End Header -->

  <!-- ======= Sidebar ======= -->
  <script>
    $(function(){
      $("#sidebar").load("aside.html");
    });
    </script>
  <!-- ======= Sidebar ======= -->
  <aside id="sidebar" class="sidebar">

  </aside><!-- End Sidebar-->

  <main id="main" class="main">
    <div class="pagetitle">
      <h1>Daily Usable</h1>
      <hr>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="index.html">Home</a></li>
          <li class="breadcrumb-item active">Daily Usable</li>
        </ol>
      </nav>
    </div><!-- End Page Title -->
    <hr>
    <section class="section">
      <div class="row">
        <div class="col-lg-6" style="width: auto;">
          <div class="card" style="width: auto;">
            <div class="card-body" style="width: auto; text-align: left;">
                <h5 class="card-title">Daily Usable</h5>
<pre>gpconfig --show max_connections

XAB23cGdZSF4j50:EsfxqeYmUgB4MDb

show all; // list Configs

gpadmin@master:~$ gpssh -f /home/gpadmin/hostfile_exkeys 'uptime'
[secondary-1]  23:08:26 up  1:02,  2 users,  load average: 0.00, 0.00, 0.00
[secondary-2]  23:08:26 up  1:02,  2 users,  load average: 0.09, 0.05, 0.01

SELECT * FROM gp_segment_configuration WHERE status='d';

template1=# select * from gp_segment_configuration;
dbid | content | role | preferred_role | mode | status | port |  hostname   |   address   |              datadir              
------+---------+------+----------------+------+--------+------+-------------+-------------+-----------------------------------
1 |      -1 | p    | p              | n    | u      | 5432 | master      | master      | /home/gpadmin/data/master/gpseg-1
3 |       1 | p    | p              | s    | u      | 6000 | secondary-2 | secondary-2 | /home/gpadmin/data/primary/gpseg1
5 |       1 | m    | m              | s    | u      | 7000 | secondary-1 | secondary-1 | /home/gpadmin/data/mirror/gpseg1
2 |       0 | p    | p              | s    | u      | 6000 | secondary-1 | secondary-1 | /home/gpadmin/data/primary/gpseg0
4 |       0 | m    | m              | s    | u      | 7000 | secondary-2 | secondary-2 | /home/gpadmin/data/mirror/gpseg0
6 |      -1 | m    | m              | s    | u      | 5432 | secondary-1 | secondary-1 | /home/gpadmin/data/master/gpseg-1
(6 rows)

gpadmin@master:~$ psql -d template1 -c &quot;select * from gp_configuration_history order by time desc limit 100;&quot;
time              | dbid |                                     desc                                      
-------------------------------+------+-------------------------------------------------------------------------------
2022-02-13 23:05:10.526804-08 |    4 | FTS: update role, status, and mode for dbid 4 with contentid 0 to m, u, and s
2022-02-13 23:05:10.526765-08 |    2 | FTS: update role, status, and mode for dbid 2 with contentid 0 to p, u, and s
2022-02-13 23:03:08.037272-08 |    4 | FTS: update role, status, and mode for dbid 4 with contentid 0 to m, d, and n
2022-02-13 23:03:08.037221-08 |    2 | FTS: update role, status, and mode for dbid 2 with contentid 0 to p, u, and n
2022-02-13 22:50:46.328733-08 |    4 | FTS: update role, status, and mode for dbid 4 with contentid 0 to m, u, and s
2022-02-13 22:50:46.328678-08 |    2 | FTS: update role, status, and mode for dbid 2 with contentid 0 to p, u, and s
2022-02-13 22:50:46.328236-08 |    5 | FTS: update role, status, and mode for dbid 5 with contentid 1 to m, u, and s
2022-02-13 22:50:46.328033-08 |    3 | FTS: update role, status, and mode for dbid 3 with contentid 1 to p, u, and s
(8 rows)

gpinitstandby -M fast -r

gpinitstandby -M fast -s secondary-1

gp_stat_operation

gplogfilter ---------------------------------------------------

Display the last three error messages in the master log file: 

gplogfilter -t -n 3 

Display all log messages in the master log file timestamped in the last 
10 minutes: 

gplogfilter -d :10 

Display log messages in the master log file containing the string 
'|con6 cmd11|': 

gplogfilter -f '|con6 cmd11|' 

Using gpssh, run gplogfilter on the segment hosts and search for log 
messages in the segment log files containing the string 'con6' and save 
output to a file. 

gpssh -f seg_hosts_file -e 'source 
/usr/local/greenplum-db/greenplum_path.sh ; gplogfilter -f con6 
/gpdata/*/pg_log/gpdb*.csv' &gt; seglog.out 

------------------------------------------------------------

gpstate ------------------------------------------------------------

Show detailed status information of a Greenplum Database system:
gpstate -s

Do a quick check for down segments in the master host system catalog:
gpstate -Q

Show information about mirror segment instances:
gpstate -m

Show information about the standby master configuration:
gpstate -f

Show details of any current gpexpand:
gpstate -x

Display the Greenplum software version information:
gpstate -i

------------------------------------------------------------------------

gpstart ----------------------------------------------------------------

Start a Greenplum Database system:
gpstart

Start a Greenplum Database system in restricted mode 
(only allow superuser connections):
gpstart -R

Start the Greenplum master instance only and connect in utility mode:
gpstart -m

PGOPTIONS='-c gp_session_role=utility' psql

Display the online help for the gpstart utility:
gpstart -?

------------------------------------------------------------------------

gpstop -----------------------------------------------------------------

Stop a Greenplum Database system in smart mode:
gpstop

Stop a Greenplum Database system in fast mode:
gpstop -M fast

Stop all segment instances and then restart the system:
gpstop -r

Stop a master instance that was started in maintenance mode:
gpstop -m

Stop all segments on a particular host, while keeping
other hosts up:
gpstop --host sdw1

Reload the postgresql.conf and pg_hba.conf files after 
making runtime configuration parameter changes but do not 
shutdown the Greenplum Database array:
gpstop -u

------------------------------------------------------------------------

Standby ----------------------------------------------------------------

Add a standby master host to your Greenplum Database system and start 
the synchronization process: 

gpinitstandby -s host09 

Start an existing standby master host and synchronize the data with the 
current primary master host: 

gpinitstandby -n 

NOTE: Do not specify the -n and -s options in the same command. 


Add a standby master host to your Greenplum Database system specifying a 
different port: 

gpinitstandby -s myhost -P 2222 

If you specify the same host name as the active Greenplum Database 
master, the installed Greenplum Database software that is used as a 
standby master must be in a separate location from the active Greenplum 
Database master.

Remove the existing standby master from your Greenplum system 
configuration: 

------------------------------------------------------------------------


Add mirroring ----------------------------------------------------------


gpexpand --------------------------------------------------------------

to add segments

Add mirroring to an existing Greenplum Database system using 
the same set of hosts as your primary data. Calculate the mirror 
database ports by adding 100 to the current primary segment port
numbers:

gpaddmirrors -p 100

Add mirroring to an existing Greenplum Database system using a 
different set of hosts from your primary data:

gpaddmirrors -i mirror_config_file

Where the mirror_config_file looks something like this:

0|sdw1-1|52001|53001|54001|/gpdata/mir1/gp0
1|sdw1-2|52002|53002|54002|/gpdata/mir2/gp1
2|sdw2-1|52001|53001|54001|/gpdata/mir1/gp2
3|sdw2-2|52002|53002|54002|/gpdata/mir2/gp3


Output a sample mirror configuration file to use with gpaddmirrors -i:

  $ gpaddmirrors -o /home/gpadmin/sample_mirror_config


------------------------------------------------------------------------


Recover / Rebalance ----------------------------------------------------

Recover any failed segment instances in place:

 $ gprecoverseg


Rebalance your Greenplum Database system after a recovery by
resetting all segments to their preferred role. First check
that all segments are up and synchronized.

  $ gpstate -m

  $ gprecoverseg -r


Recover any failed segment instances to a newly configured 
spare segment host:

  $ gprecoverseg -i recover_config_file


Output the default recovery configuration file:

  $ gprecoverseg -o /home/gpadmin/recover_config_file

------------------------------------------------------------------------

pg_dump ----------------------------------------------------------------


Usage:
  pg_dump [OPTION]... [DBNAME]

General options:
-f, --file=FILENAME          output file or directory name
-F, --format=c|d|t|p         output file format (custom, directory, tar,plain text (default))          
-j, --jobs=NUM               use this many parallel jobs to dump
-v, --verbose                verbose mode
-V, --version                output version information, then exit
-Z, --compress=0-9           compression level for compressed formats
--lock-wait-timeout=TIMEOUT  fail after waiting TIMEOUT for a table lock
-?, --help                   show this help, then exit
                
Options controlling the output content:
-a, --data-only              dump only the data, not the schema
-b, --blobs                  include large objects in dump
-c, --clean                  clean (drop) database objects before recreating
-C, --create                 include commands to create database in dump
-E, --encoding=ENCODING      dump the data in encoding ENCODING
-n, --schema=SCHEMA          dump the named schema(s) only
-N, --exclude-schema=SCHEMA  do NOT dump the named schema(s)
-o, --oids                   include OIDs in dump
-O, --no-owner               skip restoration of object ownership in plain-text format            
-s, --schema-only            dump only the schema, no data
-S, --superuser=NAME         superuser user name to use in plain-text format
-t, --table=TABLE            dump the named table(s) only
-T, --exclude-table=TABLE    do NOT dump the named table(s)
-x, --no-privileges          do not dump privileges (grant/revoke)
--binary-upgrade             for use by upgrade utilities only
--column-inserts             dump data as INSERT commands with column names
--disable-dollar-quoting     disable dollar quoting, use SQL standard quoting
--disable-triggers           disable triggers during data-only restore
--exclude-table-data=TABLE   do NOT dump data for the named table(s)
--if-exists                  use IF EXISTS when dropping objects
--inserts                    dump data as INSERT commands, rather than COPY
--no-security-labels         do not dump security label assignments
--no-synchronized-snapshots  do not use synchronized snapshots in parallel jobs
--no-tablespaces             do not dump tablespace assignments
--no-unlogged-table-data     do not dump unlogged table data
--quote-all-identifiers      quote all identifiers, even if not key words
--section=SECTION            dump named section (pre-data, data, or post-data)
--serializable-deferrable    wait until the dump can run without anomalies
--use-set-session-authorization
                                               use SET SESSION AUTHORIZATION commands instead of
                                               ALTER OWNER commands to set ownership
--gp-syntax                  dump with Greenplum Database syntax (default if gpdb)
--no-gp-syntax               dump without Greenplum Database syntax (default if postgresql)
--function-oids              dump only function(s) of given list of oids
--relation-oids              dump only relation(s) of given list of oids
                
Connection options:
-d, --dbname=DBNAME      database to dump
-h, --host=HOSTNAME      database server host or socket directory
-p, --port=PORT          database server port number
-U, --username=NAME      connect as specified database user
-w, --no-password        never prompt for password
-W, --password           force password prompt (should happen automatically)
--role=ROLENAME          do SET ROLE before dump
                
If no database name is supplied, then the PGDATABASE environment variable value is used.
                
Report bugs to &lt;bugs@greenplum.org&gt;.
                
------------------------------------------------------------------------

pg_restore -------------------------------------------------------------
                
Usage:
pg_restore [OPTION]... [FILE]
                
General options:
-d, --dbname=NAME        connect to database name
-f, --file=FILENAME      output file name
-F, --format=c|d|t       backup file format (should be automatic)
-l, --list               print summarized TOC of the archive
-v, --verbose            verbose mode
-V, --version            output version information, then exit
-?, --help               show this help, then exit
                
Options controlling the restore:
-a, --data-only              restore only the data, no schema
-c, --clean                  clean (drop) database objects before recreating
-C, --create                 create the target database
-e, --exit-on-error          exit on error, default is to continue
-I, --index=NAME             restore named index
-j, --jobs=NUM               use this many parallel jobs to restore
-L, --use-list=FILENAME      use table of contents from this file for selecting/ordering output
-n, --schema=NAME            restore only objects in this schema
-O, --no-owner               skip restoration of object ownership
-P, --function='NAME(args)'  restore named function. name must be exactly as appears in the TOC, and inside single quotes
-s, --schema-only            restore only the schema, no data
-S, --superuser=NAME         superuser user name to use for disabling triggers
-t, --table=NAME             restore named table
-T, --trigger=NAME           restore named trigger
-x, --no-privileges          skip restoration of access privileges (grant/revoke)
-1, --single-transaction     restore as a single transaction
--disable-triggers           disable triggers during data-only restore
--if-exists                  use IF EXISTS when dropping objects
--no-data-for-failed-tables  do not restore data of tables that could not be created
--no-security-labels         do not restore security labels
--no-tablespaces             do not restore tablespace assignments
--section=SECTION            restore named section (pre-data, data, or post-data)
--use-set-session-authorization 
                             use SET SESSION AUTHORIZATION commands instead of
                             ALTER OWNER commands to set ownership
                
Connection options:
  -h, --host=HOSTNAME      database server host or socket directory
  -p, --port=PORT          database server port number
  -U, --username=NAME      connect as specified database user
  -w, --no-password        never prompt for password
  -W, --password           force password prompt (should happen automatically)
  --role=ROLENAME          do SET ROLE before restore

The options -I, -n, -P, -t, -T, and --section can be combined and specified
multiple times to select multiple objects.

If no input file name is supplied, then standard input is used.

Report bugs to &lt;bugs@greenplum.org&gt;.


This is what I would do to backup my old database and restore

To back up your database

pg_dump --format=c olddb_name &gt; db_dump_file.dump
To restore that backup

pg_restore -v -d newdb_name db_dump_file.dump


------------------------------------------------------------------------

Blocking / Long Running ---------------------------------------------------------------


BLOCKING 

SELECT blocked_locks.pid     AS blocked_pid,
         blocked_activity.usename  AS blocked_user,
         blocking_locks.pid     AS blocking_pid,
         blocking_activity.usename AS blocking_user,
         blocked_activity.query    AS blocked_statement,
         blocking_activity.query   AS current_statement_in_blocking_process,
         blocked_activity.application_name AS blocked_application,
         blocking_activity.application_name AS blocking_application
   FROM  pg_catalog.pg_locks         blocked_locks
    JOIN pg_catalog.pg_stat_activity blocked_activity  ON blocked_activity.pid = blocked_locks.pid
    JOIN pg_catalog.pg_locks         blocking_locks 
        ON blocking_locks.locktype = blocked_locks.locktype
        AND blocking_locks.DATABASE IS NOT DISTINCT FROM blocked_locks.DATABASE
        AND blocking_locks.relation IS NOT DISTINCT FROM blocked_locks.relation
        AND blocking_locks.page IS NOT DISTINCT FROM blocked_locks.page
        AND blocking_locks.tuple IS NOT DISTINCT FROM blocked_locks.tuple
        AND blocking_locks.virtualxid IS NOT DISTINCT FROM blocked_locks.virtualxid
        AND blocking_locks.transactionid IS NOT DISTINCT FROM blocked_locks.transactionid
        AND blocking_locks.classid IS NOT DISTINCT FROM blocked_locks.classid
        AND blocking_locks.objid IS NOT DISTINCT FROM blocked_locks.objid
        AND blocking_locks.objsubid IS NOT DISTINCT FROM blocked_locks.objsubid
        AND blocking_locks.pid != blocked_locks.pid
 
    JOIN pg_catalog.pg_stat_activity blocking_activity ON blocking_activity.pid = blocking_locks.pid
   WHERE NOT blocked_locks.GRANTED;
   

Long Running

select pid,datname,usename,now()-pg_stat_activity.query_start AS duration,waiting from pg_stat_activity where (now()-pg_stat_activity.query_start)&gt;interval '5 minutes' order by 4 desc;

select pg_terminate_backend('&lt;pid&gt;');


------------------------------------------------------------------------

Number of connections --------------------------------------------------

select  * from
(select count(*) used from pg_stat_activity) q1,
(select setting::int res_for_super from pg_settings where name=$$superuser_reserved_connections$$) q2,
(select setting::int max_conn from pg_settings where name=$$max_connections$$) q3;

------------------------------------------------------------------------

Viewing Data Distribution ----------------------------------------------

select * from pg_settings where name like 'gp_workfile_limit%';

SELECT gp_segment_id, count(*) FROM table_name GROUP BY gp_segment_id;

Checking for Query Processing Skew -------------------------------------

SELECT gp_segment_id, count(*) FROM table_name WHERE column='value' GROUP BY gp_segment_id;


------------------------------------------------------------------------

pg_stat_operations -----------------------------------------------------

SELECT schemaname as schema, objname as table,usename as role, actionname as action,subtype as type, statime as time FROM pg_stat_operations WHERE objname='cust';

gpbackup ---------------------------------------------------------------

gpbackup --dbname database_name
   [--backup-dir directory]
   [--compression-level level]
   [--data-only]
   [--debug]
   [--exclude-schema schema_name]
   [--exclude-table schema.table]
   [--exclude-table-file file_name]
   [--include-schema schema_name]
   [--include-table schema.table]
   [--include-table-file file_name]
   [--incremental [--from-timestamp backup-timestamp]]
   [--jobs int]
   [--leaf-partition-data]
   [--metadata-only]
   [--no-compression]
   [--plugin-config config_file_location]
   [--quiet]
   [--single-data-file]
   [--verbose]
   [--version]
   [--with-stats]

gpbackup --help 

------------------------------------------------------------------------

gprestore --------------------------------------------------------------

gprestore --timestamp YYYYMMDDHHMMSS
   [--backup-dir directory]
   [--create-db]
   [--debug]
   [--exclude-schema schema_name]
   [--exclude-table schema.table]
   [--exclude-table-file file_name]
   [--include-schema schema_name]
   [--include-table schema.table]
   [--include-table-file file_name]
   [--data-only | --metadata-only]
   [--jobs int]
   [--on-error-continue]
   [--plugin-config config_file_location]
   [--quiet]
   [--redirect-db database_name]
   [--verbose]
   [--version]
   [--with-globals]
   [--with-stats]

gprestore --help


------------------------------------------------------------------------          
</pre>
              <!-- End Table with stripped rows -->
              <h3 class="card-title" style="padding: 5px 0 5px 0;font-size: 16px;"> Official VMware Link <a href="https://docs.vmware.com/en/VMware-Tanzu-Greenplum/index.html"> VMware Greenplum Database<a></h3>
              <h3 class="card-title" style="padding: 5px 0 5px 0;font-size: 16px;"> Official Github Link <a href="https://github.com/greenplum-db/gpdb"> Greenplum Database Open Source<a></h3>
            </div>
          </div>
        </div>

      </div>
    </section>

  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer">
    <div class="copyright">
      &copy; Copyright <strong><span>Greenplum DBA 2023</span></strong>. All Rights Reserved
    </div>
    <div class="credits">
      Designed by <a href="https://www.linkedin.com/in/kishan-panchal-6004ab1b4/">@Kishan Panchal</a>
    </div>
  </footer><!-- End Footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/chart.js/chart.umd.js"></script>
  <script src="assets/vendor/echarts/echarts.min.js"></script>
  <script src="assets/vendor/quill/quill.min.js"></script>
  <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
  <script src="assets/vendor/tinymce/tinymce.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>

</body>

</html>